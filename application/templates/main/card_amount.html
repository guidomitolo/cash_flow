{% extends "base.html" %} 

{% block content %}
    <h2>Gastos</h2>
    <h5 style="margin-bottom: 20px;">Selecciones banco y período</h5>
    {% if cards %}
    <p>Tarjetas cargadas</p>
    <form method="post">
        <select name="cards">
            {% for card in cards%}
            <option name="card" value="{{ card.card }} {{ card.card_number }}">{{ card.card }} {{ card.card_number }}</option>
            {% endfor %}            
        </select>
        <button type='submit' name="button_select_card" value="select">Elegir</button>
        {% if sel_card %}
        {{ sel_card}}
        {% endif %}
    </form>
    {% else %}
    <p>No hay tarjetas cargadas</p>
    {% endif %}
    {% if dues %}
    <p>Vencimientos detectados</p>
    <form method="post">
        <select name="dues">
            {% for due in dues%}
            <option name="due" value="{{ due.due_date.date() }}">{{ due.due_date.date() }}</option>
            {% endfor %}            
        </select>
        <button type='submit' name="button_select_date" value="select">Elegir</button>
        {% if sel_date %}
        {{ sel_date }}
        {% endif %}
    </form>
    {% else %}
    <p>No hay tarjetas cargadas</p>
    {% endif %}

    {% if data.items %}
    <table class="table table-sm" style='margin-top: 20px;'>
        <thead>
            <tr>
                <!-- <th style="text-align: center;">Elegir</th> -->
                {% if cards %}
                <th><input type="checkbox" onclick="selects_card()" id="check_all_card" name="check_all_card" value="all"></th>
                {% endif %}
                <th style="text-align: center;">Tarjeta</th>
                <th style="text-align: center;">Nro. de Tarjeta</th>
                <th style="text-align: center;">Banco</th>
                <th style="text-align: center;">Cierre</th>
                {% if dues %}
                <th><input type="checkbox" onclick="selects_due()" id="check_all_due" name="check_all_due" value="all"></th>
                {% endif %}
                <th style="text-align: center;">Vencimiento</th>
                <th style="text-align: center;">Consumo</th>
                <th style="text-align: center;">Acreedor</th>
                <th>Cuota</th>
                <th>ARS</th>
                <th style="text-align: center;">USD</th>
                <th style="text-align: center;">Concepto</th>
            </tr>
        </thead>
        <form method="POST" id="select_items" novalidate>
            <tbody>
            {% for row in data.items %}
                <tr>
                    {% if cards %}
                    <td><input type="checkbox" id="item_{{ loop.index }}" name="chk_card" value="{{ row.id }}"></td>
                    {% endif %}
                    {% if vendors %}
                    <td>{{ vendors[loop.index0] }}</td>
                    {% else %}
                    <td>-</td>
                    {% endif %}
                    <td>{{ row.card_number }}</td>
                    <td>{{ row.bank }}</td>
                    {% if row.card_summary  %}
                    <td>{{ row.card_summary.date() }}</td>
                    {% else %}
                    <td>-</td>
                    {% endif %}
                    {% if dues %}
                    <td><input type="checkbox" id="item_{{ loop.index }}" name="chk_due" value="{{ row.id }}"></td>
                    {% endif %}
                    {% if row.item_payed.due_date  %}
                    <td>{{ row.item_payed.due_date.date() }}</td>
                    {% else %}
                    <td>-</td>
                    {% endif %}
                    <td>{{ row.timestamp.date() }}</td>
                    <td>{{ row.creditor }}</td>
                    {% if row.share  %}
                    <td>{{ row.share }}</td>
                    {% else %}
                    <td>Única</td>
                    {% endif %}
                    <td>{{ row.ars }}</td>
                    <td style="text-align: center;">{{ row.usd }}</td>
                    {% if row.tag  %}
                    <td>{{ row.tag }}</td>
                    {% else %}
                    <td></td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </form>
    </table>

    {% for page_num in data.iter_pages(left_edge = 1, right_edge=1, left_current=1, right_current=2 ) %}
    {% if page_num %}
        {% if page_num == data.page %}
        <a class="btn btn-info mb-4" href="{{ url_for('main.card_amount', page=page_num )}}">{{ page_num }}</a>
        {% else %}
        <a class="btn btn-outline-info mb-4" href="{{ url_for('main.card_amount', page=page_num )}}">{{ page_num }}</a>
        {% endif %}    
    {% else %}
    ...
    {% endif %}
    {% endfor %}

    <button type="submit" value="items" form="select_items" name='items_selected'>Aplicar</button>
    {% else %}
    <p>No hay consumos de tarjeta cargados</p>
    
    {% endif %}


    <script type="text/javascript">
        function selects_card() {
            var checkBox = document.getElementById("check_all_card");
            var box = document.getElementsByName('chk_card');

            if (checkBox.checked == true){
                for(var i=0; i<box.length; i++){  
                    if(box[i].type=='checkbox')  
                        box[i].checked=true;  
                }                
            } else {
                for(var i=0; i<box.length; i++){  
                    if(box[i].type=='checkbox')  
                        box[i].checked=false;  
                } 
            }
        }
        function selects_due() {
            var checkBox = document.getElementById("check_all_due");
            var box = document.getElementsByName('chk_due');

            if (checkBox.checked == true){
                for(var i=0; i<box.length; i++){  
                    if(box[i].type=='checkbox')  
                        box[i].checked=true;  
                }                
            } else {
                for(var i=0; i<box.length; i++){  
                    if(box[i].type=='checkbox')  
                        box[i].checked=false;  
                } 
            }
        }  
    </script>  

{% endblock %}